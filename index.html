<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alur H2H — Pembayaran Online</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root{--bg:#0f172a;--muted:#64748b;--card:#ffffff;--glass:rgba(255,255,255,0.06)}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    .soft-glow{box-shadow:0 6px 30px rgba(15,23,42,0.08);backdrop-filter: blur(6px)}
    .step-card{transition:transform .28s cubic-bezier(.2,.9,.3,1),box-shadow .28s;will-change:transform}
    .step-card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(2,6,23,0.12)}
    /* small responsive adjustments for svg texts */
    @media (max-width: 800px){ .flow-svg text.small{display:none} }
  </style>
</head>
<body class="bg-gradient-to-b from-slate-50 to-white min-h-screen text-slate-800">
  <div class="max-w-6xl mx-auto p-6 lg:p-12">
    <header class="flex items-center justify-between mb-8">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-600 to-sky-500 flex items-center justify-center text-white font-bold shadow-md">H2H</div>
        <div>
          <h1 class="text-2xl lg:text-3xl font-extrabold">Alur H2H — Pembayaran Online</h1>
          <p class="text-sm text-slate-500">Host-to-Host flow untuk merchant & payment gateway — modern, dinamis, dan siap dipakai.</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <button id="downloadPng" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800 text-white text-sm shadow hover:brightness-105 transition">
          Unduh PNG
        </button>
        <button id="exportJson" class="px-4 py-2 rounded-lg border border-slate-200 text-sm hover:bg-slate-100 transition">Export JSON</button>
      </div>
    </header>

    <main class="grid lg:grid-cols-3 gap-8 items-start">
      <!-- Left Panel -->
      <section class="lg:col-span-1 bg-white rounded-2xl p-6 soft-glow">
        <h2 class="text-lg font-semibold mb-3">Ringkasan Alur</h2>
        <p class="text-sm text-slate-600 mb-4">Flow H2H ini menunjukkan komunikasi real-time antara Merchant & Payment Gateway/Bank: request -> kode bayar -> pembayaran -> callback -> update -> rekonsiliasi.</p>

        <div class="space-y-3">
          <div class="flex gap-3 items-start">
            <div class="p-2 rounded-md bg-indigo-50"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20" stroke="#6366f1" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
            <div>
              <div class="text-sm font-medium">Kecepatan</div>
              <div class="text-xs text-slate-600">Callback realtime mengurangi kebutuhan polling.</div>
            </div>
          </div>

          <div class="flex gap-3 items-start">
            <div class="p-2 rounded-md bg-emerald-50"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M20 6L9 17l-5-5" stroke="#10b981" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
            <div>
              <div class="text-sm font-medium">Keamanan</div>
              <div class="text-xs text-slate-600">Gunakan TLS, HMAC signature, dan nonce untuk mencegah replay attack.</div>
            </div>
          </div>

          <div class="flex gap-3 items-start">
            <div class="p-2 rounded-md bg-amber-50"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12h18" stroke="#f59e0b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
            <div>
              <div class="text-sm font-medium">Rekonsiliasi</div>
              <div class="text-xs text-slate-600">Rekonsiliasi harian & laporan settlement untuk memastikan arus kas.</div>
            </div>
          </div>
        </div>

        <div class="mt-6">
          <h3 class="text-sm font-semibold mb-2">Contoh Payload (Merchant → PG)</h3>
<pre class="bg-slate-50 rounded p-3 text-xs overflow-auto">
POST /api/payments
{
  "merchant_id": "M-12345",
  "order_id": "INV-20250915-0001",
  "amount": 150000,
  "currency": "IDR",
  "callback_url": "https://merchant.example.com/callback",
  "signature": "hmac_sha256(...)"
}
</pre>
        </div>
      </section>

      <!-- Middle + Right: Flowchart and Steps -->
      <section class="lg:col-span-2 bg-white rounded-2xl p-6 soft-glow">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">Flowchart Interaktif</h2>
          <div class="text-sm text-slate-500">Klik langkah untuk melihat detail; seret diagram untuk gerakkan (desktop).</div>
        </div>

        <div id="flowArea" class="border border-slate-100 rounded-lg p-4 overflow-auto">
          <div class="flex flex-col lg:flex-row gap-6">
            <div class="flex-1 relative">
              <!-- SVG Flowchart -->
              <div id="svgWrap" class="w-full overflow-auto">
                <svg id="flowSvg" class="flow-svg" viewBox="0 0 1100 260" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
                      <feGaussianBlur stdDeviation="6" result="blur"/>
                      <feBlend in="SourceGraphic" in2="blur" mode="normal"/>
                    </filter>
                    <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
                      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0f172a" opacity="0.9" />
                    </marker>
                  </defs>

                  <!-- Background subtle -->
                  <rect x="0" y="0" width="1100" height="260" fill="transparent"></rect>

                  <!-- Nodes -->
                  <!-- 1 -->
                  <g class="node" data-id="1" transform="translate(40,40)" style="cursor:pointer">
                    <rect x="0" y="0" rx="16" width="200" height="140" fill="#fff" stroke="#e6eef8" />
                    <text x="18" y="28" font-size="14" font-weight="700" fill="#0f172a">1. Pelanggan Order</text>
                    <text x="18" y="54" font-size="12" fill="#475569" class="small">Memilih produk, mengisi data, memilih metode pembayaran.</text>
                  </g>

                  <!-- 2 -->
                  <g class="node" data-id="2" transform="translate(290,40)" style="cursor:pointer">
                    <rect x="0" y="0" rx="16" width="200" height="140" fill="#fff" stroke="#f5f3ff" />
                    <text x="18" y="28" font-size="14" font-weight="700" fill="#0f172a">2. Merchant → PG/Bank</text>
                    <text x="18" y="54" font-size="12" fill="#475569" class="small">Kirim request via API H2H (order_id, amount, callback).</text>
                  </g>

                  <!-- 3 -->
                  <g class="node" data-id="3" transform="translate(540,40)" style="cursor:pointer">
                    <rect x="0" y="0" rx="16" width="200" height="140" fill="#fff" stroke="#ecfdf5" />
                    <text x="18" y="28" font-size="14" font-weight="700" fill="#0f172a">3. PG/Bank Validasi</text>
                    <text x="18" y="54" font-size="12" fill="#475569" class="small">Validasi & keluarkan kode/link pembayaran (status pending).</text>
                  </g>

                  <!-- 4 -->
                  <g class="node" data-id="4" transform="translate(790,40)" style="cursor:pointer">
                    <rect x="0" y="0" rx="16" width="200" height="140" fill="#fff" stroke="#fff1f2" />
                    <text x="18" y="28" font-size="14" font-weight="700" fill="#0f172a">4. Pelanggan Bayar</text>
                    <text x="18" y="54" font-size="12" fill="#475569" class="small">Melalui e-wallet, mobile banking, ATM, atau kartu kredit.</text>
                  </g>

                  <!-- 5 -->
                  <g class="node" data-id="5" transform="translate(165,170)" style="cursor:pointer">
                    <rect x="0" y="0" rx="16" width="200" height="70" fill="#fff" stroke="#eef2ff" />
                    <text x="18" y="24" font-size="14" font-weight="700" fill="#0f172a">5. Callback ke Merchant</text>
                    <text x="18" y="48" font-size="12" fill="#475569" class="small">PG/Bank kirim notifikasi bahwa pembayaran SUKSES.</text>
                  </g>

                  <!-- 6 -->
                  <g class="node" data-id="6" transform="translate(430,170)" style="cursor:pointer">
                    <rect x="0" y="0" rx="16" width="200" height="70" fill="#fff" stroke="#f1f5f9" />
                    <text x="18" y="24" font-size="14" font-weight="700" fill="#0f172a">6. Proses & Rekonsiliasi</text>
                    <text x="18" y="48" font-size="12" fill="#475569" class="small">Merchant update status, kirim konfirmasi & settlement.</text>
                  </g>

                  <!-- Connectors -->
                  <path d="M 240 110 C 265 110 285 110 290 110" stroke="#0f172a" stroke-width="1.2" fill="none" marker-end="url(#arrow)" opacity="0.12"></path>
                  <path d="M 490 110 C 515 110 535 110 540 110" stroke="#0f172a" stroke-width="1.2" fill="none" marker-end="url(#arrow)" opacity="0.12"></path>
                  <path d="M 740 110 C 765 110 785 110 790 110" stroke="#0f172a" stroke-width="1.2" fill="none" marker-end="url(#arrow)" opacity="0.12"></path>

                  <!-- From node 3 down to node 5 -->
                  <path d="M 640 160 C 640 170 640 180 560 180" stroke="#0f172a" stroke-width="1.2" fill="none" marker-end="url(#arrow)" opacity="0.12"></path>

                  <!-- From node 4 down to node 6 (dashed) -->
                  <path d="M 890 160 C 890 170 820 170 630 170" stroke="#0f172a" stroke-width="1.0" fill="none" stroke-dasharray="6 6" marker-end="url(#arrow)" opacity="0.08"></path>
                </svg>
              </div>

              <!-- small hint -->
              <div class="text-xs text-slate-400 mt-3">Tip: Klik salah satu kotak untuk melihat detail di panel kanan.</div>
            </div>

            <div class="w-80 hidden lg:block">
              <h4 class="text-sm font-semibold mb-3">Detail Langkah</h4>
              <div id="detailList" class="space-y-3">
                <!-- step cards inserted by JS -->
              </div>
            </div>
          </div>

          <!-- Mobile step list -->
          <div class="lg:hidden mt-4 grid grid-cols-2 gap-3">
            <div class="step-card p-3 rounded-lg bg-indigo-50 border border-slate-100">
              <div class="text-xs font-semibold">1. Pelanggan Order</div>
              <div class="text-[11px] text-slate-600">Pilih produk & metode.</div>
            </div>
            <div class="step-card p-3 rounded-lg bg-amber-50 border border-slate-100">
              <div class="text-xs font-semibold">2. Merchant → PG/Bank</div>
              <div class="text-[11px] text-slate-600">Kirim request via API H2H.</div>
            </div>
            <div class="step-card p-3 rounded-lg bg-emerald-50 border border-slate-100">
              <div class="text-xs font-semibold">3. PG/Bank Validasi</div>
              <div class="text-[11px] text-slate-600">Keluarkan kode/link pembayaran.</div>
            </div>
            <div class="step-card p-3 rounded-lg bg-pink-50 border border-slate-100">
              <div class="text-xs font-semibold">4. Pelanggan Bayar</div>
              <div class="text-[11px] text-slate-600">Bayar via e-wallet atau bank.</div>
            </div>
            <div class="step-card p-3 rounded-lg bg-violet-50 border border-slate-100">
              <div class="text-xs font-semibold">5. Callback ke Merchant</div>
              <div class="text-[11px] text-slate-600">PG/Bank kirim status PAID.</div>
            </div>
            <div class="step-card p-3 rounded-lg bg-slate-50 border border-slate-100">
              <div class="text-xs font-semibold">6. Proses & Rekonsiliasi</div>
              <div class="text-[11px] text-slate-600">Update order & settlement.</div>
            </div>
          </div>

        </div>

        <!-- Simulasi kecil -->
        <div class="mt-6">
          <h3 class="text-sm font-semibold mb-2">Simulasi Status</h3>
          <div class="flex gap-3 flex-wrap">
            <button data-step="1" class="status-pill px-3 py-2 bg-white rounded-full border border-slate-200 shadow-sm text-sm">1. Order</button>
            <button data-step="2" class="status-pill px-3 py-2 bg-white rounded-full border border-slate-200 shadow-sm text-sm">2. Request</button>
            <button data-step="3" class="status-pill px-3 py-2 bg-white rounded-full border border-slate-200 shadow-sm text-sm">3. Pending</button>
            <button data-step="4" class="status-pill px-3 py-2 bg-white rounded-full border border-slate-200 shadow-sm text-sm">4. Paid</button>
            <button data-step="5" class="status-pill px-3 py-2 bg-white rounded-full border border-slate-200 shadow-sm text-sm">5. Callback</button>
            <button data-step="6" class="status-pill px-3 py-2 bg-white rounded-full border border-slate-200 shadow-sm text-sm">6. Settled</button>
          </div>
        </div>

      </section>
    </main>

    <footer class="max-w-6xl mx-auto mt-8 text-center text-sm text-slate-500">
      Dibuat otomatis — halaman dokumentasi integrasi H2H untuk tim dev.
    </footer>
  </div>

<script>
// Steps data used by JS
const steps = [
  { id:1, title:'1. Pelanggan Order', desc:'Pilih produk, isi data, pilih metode pembayaran.'},
  { id:2, title:'2. Merchant → PG/Bank', desc:'Merchant kirim data transaksi via API H2H (ID, amount, callback URL).'},
  { id:3, title:'3. PG/Bank Validasi', desc:'Validasi data & keluarkan kode/link pembayaran (pending).'},
  { id:4, title:'4. Pelanggan Bayar', desc:'Bayar melalui e-wallet, mobile banking, ATM, atau kartu kredit.'},
  { id:5, title:'5. Callback ke Merchant', desc:'PG/Bank kirim notifikasi callback bahwa pembayaran SUKSES.'},
  { id:6, title:'6. Proses & Rekonsiliasi', desc:'Merchant update status, kirim konfirmasi & settlement.'},
];

// Populate detail panel (desktop)
const detailList = document.getElementById('detailList');
steps.forEach(s=>{
  const card = document.createElement('div');
  card.className = 'step-card p-3 rounded-xl bg-white border border-slate-100';
  card.innerHTML = `<div class="flex items-start gap-3"><div class="w-10 h-10 rounded-lg bg-white/60 flex items-center justify-center text-slate-800 font-medium">${s.id}</div><div><div class="text-sm font-medium">${s.title}</div><div class="text-xs text-slate-600">${s.desc}</div></div></div>`;
  card.addEventListener('mouseenter', ()=>pulseNode(s.id));
  card.addEventListener('click', ()=>highlightNode(s.id));
  detailList.appendChild(card);
});

// Interactivity: clicking svg nodes
document.querySelectorAll('#flowSvg .node').forEach(g=>{
  g.addEventListener('click', ()=>{
    const id = parseInt(g.getAttribute('data-id'));
    highlightNode(id);
  });
  g.addEventListener('mouseenter', ()=>{
    gsap.to(g.querySelector('rect'), {scale:1.03, transformOrigin:'center center', duration:0.28});
  });
  g.addEventListener('mouseleave', ()=>{
    gsap.to(g.querySelector('rect'), {scale:1, duration:0.28});
  });
});

function highlightNode(id){
  // reset
  document.querySelectorAll('#flowSvg .node rect').forEach(r=> r.setAttribute('stroke','rgba(226,232,240,1)'));
  const target = document.querySelector(`#flowSvg .node[data-id="${id}"] rect`);
  if(target){
    target.setAttribute('stroke','#2563eb');
    gsap.fromTo(target, {filter:'drop-shadow(0 0px rgba(37,99,235,0.0))'}, {filter:'drop-shadow(0 12px rgba(37,99,235,0.14))', duration:0.35, yoyo:true, repeat:1});
  }
  // scroll detail into view
  const cards = Array.from(detailList.children);
  const idx = cards.findIndex(c=> c.querySelector('div > div').textContent.trim().startsWith(id));
  if(idx>=0){
    cards[idx].scrollIntoView({behavior:'smooth', block:'nearest'});
    gsap.fromTo(cards[idx], {x:-8, opacity:0.8}, {x:0, opacity:1, duration:0.35});
  }
}

// pulse animation used on hover in detail list
function pulseNode(id){
  const g = document.querySelector(`#flowSvg .node[data-id="${id}"]`);
  if(!g) return;
  gsap.fromTo(g.querySelector('rect'), {scale:1}, {scale:1.02, duration:0.28, yoyo:true, repeat:1});
}

// Status simulation buttons
document.querySelectorAll('.status-pill').forEach(b=>{
  b.addEventListener('click', ()=>{
    const step = parseInt(b.getAttribute('data-step'));
    animateProgress(step);
  });
});

function animateProgress(step){
  // highlight nodes up to step
  document.querySelectorAll('#flowSvg .node rect').forEach((rect,i)=>{
    const id = parseInt(rect.parentNode.getAttribute('data-id'));
    if(id <= step){
      rect.setAttribute('fill','#f8fafc');
      rect.setAttribute('stroke','#06b6d4');
      gsap.to(rect, {duration:0.5, attr:{x:0}, ease:'power2.out'});
    } else {
      rect.setAttribute('fill','#fff');
      rect.setAttribute('stroke','#e6eef8');
    }
  });
}

// Export JSON sample
document.getElementById('exportJson').addEventListener('click', ()=>{
  const payload = {merchant_id:'M-12345', order_id:'INV-20250915-0001', amount:150000, currency:'IDR', callback_url:'https://merchant.example.com/callback'};
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'sample_payment_request.json';
  document.body.appendChild(link);
  link.click();
  link.remove();
});

// Download PNG (capture flowArea)
document.getElementById('downloadPng').addEventListener('click', ()=>{
  const el = document.getElementById('flowArea');
  html2canvas(el, {scale:2, backgroundColor:null}).then(canvas=>{
    const link = document.createElement('a');
    link.download = 'alur_h2h_pembayaran_online.png';
    link.href = canvas.toDataURL('image/png');
    document.body.appendChild(link);
    link.click();
    link.remove();
  }).catch(err=> alert('Gagal membuat PNG: '+err.message));
});

// small drag to pan on desktop for svgWrap
(function enableDrag(){
  const wrap = document.getElementById('svgWrap');
  let pos = {x:0,y:0,down:false,startX:0,startY:0,scrollLeft:0,scrollTop:0};
  wrap.addEventListener('mousedown', e=>{
    pos.down = true;
    wrap.classList.add('cursor-grabbing');
    pos.startX = e.pageX - wrap.offsetLeft;
    pos.startY = e.pageY - wrap.offsetTop;
    pos.scrollLeft = wrap.scrollLeft;
    pos.scrollTop = wrap.scrollTop;
  });
  window.addEventListener('mouseup', ()=>{ pos.down=false; wrap.classList.remove('cursor-grabbing'); });
  window.addEventListener('mousemove', e=>{
    if(!pos.down) return;
    e.preventDefault();
    const x = e.pageX - wrap.offsetLeft;
    const walkX = (x - pos.startX);
    wrap.scrollLeft = pos.scrollLeft - walkX;
  });
})();

// initial anim
gsap.from('#flowSvg .node rect', {opacity:0, y:8, stagger:0.08, duration:0.6, ease:'power2.out'});
gsap.from('#detailList > div', {opacity:0, y:8, stagger:0.06, duration:0.6});

</script>
</body>
</html>
